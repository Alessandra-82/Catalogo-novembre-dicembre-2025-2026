<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Catalogo – Lettore</title>

  <!-- epub.js -->
  <script src="https://cdn.jsdelivr.net/npm/epubjs/dist/epub.min.js"></script>

  <style>
    html, body { margin:0; height:100%; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }

    #bar {
      height: 44px;
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 0 10px;
      border-bottom: 1px solid #ddd;
      box-sizing: border-box;
    }

    button {
      padding: 6px 10px;
      cursor: pointer;
    }

    #msg {
      margin-left: 6px;
      font-size: 14px;
      opacity: 0.85;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    #viewer {
      height: calc(100vh - 44px);
      width: 100%;
    }
  </style>
</head>

<body>
  <div id="bar">
    <button id="prev" type="button">◀ Indietro</button>
    <button id="next" type="button">Avanti ▶</button>
    <span id="msg">Caricamento…</span>
  </div>

  <div id="viewer"></div>

  <script>
    // URL PUBBLICO del file EPUB (GitHub Pages, non github.com)
    const EPUB_URL =
      "https://alessandra-82.github.io/Catalogo-novembre-dicembre-2025-2026/Catalogo%20del%20lettore.epub";

    const msg = document.getElementById("msg");
    const viewer = document.getElementById("viewer");

    function setMsg(text) {
      msg.textContent = text;
    }

    async function main() {
      try {
        setMsg("Caricamento EPUB…");

        // Inizializza libro
        const book = ePub(EPUB_URL, { openAs: "epub" });

        // Rendering
        const rendition = book.renderTo(viewer, {
          width: "100%",
          height: "100%"
        });

        // Navigazione
        document.getElementById("next").addEventListener("click", () => rendition.next());
        document.getElementById("prev").addEventListener("click", () => rendition.prev());

        // Tastiera (utile su PC)
        document.addEventListener("keydown", (e) => {
          if (e.key === "ArrowRight") rendition.next();
          if (e.key === "ArrowLeft") rendition.prev();
        });

        // Mostra la prima pagina
        await rendition.display();
        setMsg("Pronto");

        // Errori caricamento
        book.ready.catch((err) => {
          console.error(err);
          setMsg("Errore caricamento EPUB");
        });

        // (opzionale) Titolo libro
        book.loaded.metadata.then((meta) => {
          if (meta && meta.title) document.title = meta.title;
        }).catch(() => {});
      } catch (err) {
        console.error(err);
        setMsg("Errore: " + (err?.message || err));
      }
    }

    main();
  </script>
</body>
</html>
